# 各坐标系归一化规范

## 一、世界坐标系

### 1.1 定义

世界坐标系是一个基于<font color="#f40">原点</font>的全局坐标系，定义了真实世界中物体的相对坐标位置。

#### 1.1.1 原点

$O_w$可以任意设定，通常选择一个规则矩形的一角作为基准点。

- 对于地面情况，选择房间的墙角作为物理基准点：

  - 该基准点偏向东侧的`地面-墙体`为$X_w$轴；

  - 按右手坐标系原则选择偏南侧的`地面-墙体`为$Y_w$轴；

  - 则$Z_w$轴垂直向下，朝向地面。

- 对于桌面情况，选择桌面边缘直角作为物理基准点：

  - 该基准点的$X_w$轴和$Y_w$轴，定义原则和上述过程一致。
  - $Z_w$轴同样垂直，若朝上，$Y_w$轴正向则定义为偏北侧。



#### 1.1.2 坐标表示

$X_w, Y_w, Z_w$



#### 1.1.3 坐标轴方向

通过外参定义，计算机图形默认<font color="#f40">右手坐标系</font>，即正方向：

- $X_w$轴：平行用于标定原点的矩形的一边。一般朝右。
- $Y_w$轴：垂直于$X_w$轴。形成二维平面坐标系。
- $Z_w$轴：垂直与$X_w, Y_w$组成的二维平面。一般朝上表示高度。



#### 1.1.4 计量单位

单位<font color="#f40">毫米(mm)</font>，`get_params.py`中有二维矩阵`world_points`(x, y, z)定义该参数，第一个点[0, 0, 0]为原点。

示例

```python
world_points = np.array([[0, 0, 0], [300, 0, 0], [300, 300, 0], [0, 300, 0]])
```



---



### 1.2 图示

![image-20250304194147600](https://typora-picture-zhao.oss-cn-beijing.aliyuncs.com/Typora/image-20250304194147600.png)





## 二、相机坐标系

### 2.1 定义

相机拍摄物体的描述该物体相对于相机的位置。

可以理解为基于相机镜头的原点$O_c$建立坐标系，被拍摄的物体在该相机坐标系的位置。

#### 2.1.1 原点

$O_c$定义为相机镜头成像点，相机镜头的成像中心(针孔成像模型的那个孔)。

![img](https://i-blog.csdnimg.cn/direct/af226c1c1c5e45ce90c08543137630e7.png#pic_center)



#### 2.1.2 坐标表示

$X_c, Y_c, Z_c$



#### 2.1.3 坐标轴方向

> 假设手持相机的情况

默认定义以$O_c$​成像点为原点：

相机坐标系使用<font color="#f40">右手坐标系</font>，保证拍摄物体的距离Z为正值。即正方向：

- $X_c$轴：水平向右，右手边为正方向。
- $Y_c轴$：垂直于$X_c$轴，脚下为正方向。
- $Z_c$轴：同世界坐标系，垂直于$X_c, Y_c$组成的平面，前面(镜头指向的方向)为正方向。



#### 2.1.4 计量单位

单位<font color="#f40">毫米(mm)</font>，OpenCV计算表图像默认单位。



---



### 2.2 图示

![image-20250304201146311](https://typora-picture-zhao.oss-cn-beijing.aliyuncs.com/Typora/image-20250304201146311.png)



---



### 2.3 坐标转换

> $P_w转换为P_c$

世界坐标系中的坐标点转换为相机坐标系的点，使用外参就行。

#### 2.3.1 转换公式

- $R$是旋转矩阵，用来调整方向，表示相机坐标系相对于世界坐标系的旋转角度。

  可以通过旋转向量转换得到，转换可以用OpenCV的函数`Rodrigues()`，该函数解析：

  ![image-20250304203344520](https://typora-picture-zhao.oss-cn-beijing.aliyuncs.com/Typora/image-20250304203344520.png)

- $T$就是平移向量，表示相机位移，除了旋转对齐世界坐标系外还需要平移，才能找到世界坐标系中的远点在相机坐标系的位置。

$$
\begin{bmatrix}
X_c \\ 
Y_c	\\	
Z_c	\\
\end{bmatrix}
= R *
\begin{bmatrix}
X_w	\\
Y_w	\\
Z_w	\\
\end{bmatrix}
+ T
$$

将世界坐标系转换成相机坐标系中的点，以上公式可以简化为：
$$
P_c = R * P_w + T
$$


#### 2.3.2 转换计量单位

旋转矩阵是没有单位的，平移向量的单位就看标定的时候使用的单位(外参)，该文档统一定义为<font color="#f40">毫米(mm)</font>。





## 三、相机二维坐标系

### 3.1 定义

相机二维坐标系是将三维的Z轴去掉了，变成基于相机镜头成像点的二维坐标系。

#### 3.1.1 原点

相机二维坐标系图像中心(主点坐标)$O_i$定义同相机三维坐标系(去掉Z轴)，相机镜头成像点。



#### 3.1.2 坐标表示

$X_i, Y_i$



#### 3.1.3 坐标轴方向

> 假设手持相机的情况

默认定义以$O_i$​成像点为原点：

相机二维坐标系使用<font color="#f40">右手坐标系</font>，即正方向：

- $X_c$轴：水平向右，右手边为正方向。
- $Y_c轴$：垂直于$X_c$轴，脚下为正方向。



---



### 3.2 图示

![image-20250304215218045](https://typora-picture-zhao.oss-cn-beijing.aliyuncs.com/Typora/image-20250304215218045.png)



---



### 3.3 坐标转换

> $P_c转换为P_i$

相机坐标系中的坐标点转换为相机二维坐标系的坐点。

#### 3.3.1 转换公式

- $Z_c$表示深度值，处理完后得到的结果($X_i, Y_i$)，是没有单位的，它表示一个比例；

  被摄物体发出的光线到相机镜头成像点的距离$Z_c$(深度)在该投影计算过程中丢失；

  原因是：相机采样同一射线上的所有点($Z_c$)，对应的像素坐标是相同的，所以单目相机是无法获取深度值的。

​	$$X_i = \frac{X_c}{Z_c} \\ \\ Y_i = \frac{Y_c}{Z_c}$$



#### 3.3.2 转换计量单位

$X_c、Y_c$单位取决于定义外参时使用的单位，本文档定义为<font color="#f40">毫米(mm)</font>，约定俗成。





## 四、图像像素坐标系

### 4.1 定义

图像坐标系，2D坐标系。是表示二维图像上某个像素点的坐标系。

#### 4.1.1 原点

本文用画图举例，画图使用的通用图像坐标系，是以图像左上角为原点$O_p$。



#### 4.1.2 坐标表示

$X_p, Y_p$



#### 4.1.3 坐标轴方向

- $X_p$轴：基于图像方向，水平向右。
- $Y_p$轴：基于图像垂直$X_p$轴，竖直向下。



#### 4.1.4 计量单位

单位<font color="#f40">像素(px)</font>，图像通用单位。



---



### 4.2 图示

![image-20250304222323384](https://typora-picture-zhao.oss-cn-beijing.aliyuncs.com/Typora/image-20250304222323384.png)



---



### 4.3 坐标转换

#### 4.3.1 转换公式

$$
\begin{bmatrix}
X_p \\
Y_p \\
1 \\
\end{bmatrix}
= K *
\begin{bmatrix}
X_i \\
Y_i \\
1
\end{bmatrix}
$$

$$
X_p = f_x * X_i + c_x \\
Y_p = f_y * Y_i + c_y
$$



- $K$是内参矩阵，用来表述相机的焦距$f_x、f_y$与该焦距下拍摄图像，图像的中心点$c_x、c_y$(图像中心主点坐标)。

  
  $$
  K = 
  \begin{bmatrix}
  f_x & 0 & c_x \\
  0 & f_y & c_y \\
  0 & 0 & 1
  \end{bmatrix}
  $$

  - $f_x, f_y$：水平焦距、垂直焦距。
  - $c_x, c_y$：主点坐标，就是是焦距除2即为图像中心。

- $X_i, Y_i$是相机二维坐标，比例无单位。



#### 4.3.2 转换计量单位

$X_p, Y_p$坐标单位为<font color="#f40">像素(px)</font>





## 五、图像像素坐标校正

### 5.1 畸变

像素坐标系坐标由于相机镜头的畸变，会导致不精确，需要更精确就使用内参的畸变系数(dist_coeffs)校正。

#### 5.1.1 径/切向畸变

在MATLAB中标定内参时选中`3coeffs`、`Tangential`，对应径向畸变$k$、切向畸变$p$

![image-20250304231432962](https://typora-picture-zhao.oss-cn-beijing.aliyuncs.com/Typora/image-20250304231432962.png)



#### 5.1.2 矫正方式

可以用OpenCV的函数`undistortPoints()[2/2]`，标定参数如下：

![image-20250304231750511](https://typora-picture-zhao.oss-cn-beijing.aliyuncs.com/Typora/image-20250304231750511.png)